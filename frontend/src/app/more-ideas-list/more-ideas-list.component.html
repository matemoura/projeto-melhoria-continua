<div class="list-container">
  <div class="list-header">
    <h2>ðŸ’¡ Ideias Enviadas</h2>
    <p>Visualize todas as sugestÃµes de melhoria registradas na plataforma.</p>

    <div *ngIf="authService.hasAnyRole(['melhoria continua', 'admin']) && ideas.length > 0" class="export-container">
      <button (click)="exportToExcel()" class="export-button">ðŸ“¥ Exportar para Excel</button>
    </div>
  </div>

  <div class="search-container">
    <input type="text" placeholder="Buscar por usuÃ¡rio ou nome do Kaizen..." [(ngModel)]="searchTerm" (input)="onSearchChange()"/>
    <select [(ngModel)]="selectedStatus" (change)="onSearchChange()">
      <option value="">Todos os Status</option>
      <option *ngFor="let status of statuses" [value]="status">{{ formatStatusForDisplay(status) }}</option>
    </select>
  </div>

  <div *ngIf="isLoading" class="spinner">Carregando ideias...</div>
  <div *ngIf="loadError" class="error-message">{{ loadError }}</div>
  <div *ngIf="!isLoading && ideas.length === 0" class="empty-message">
    Nenhuma ideia foi enviada ainda. Seja o primeiro!
  </div>

  <div *ngIf="!isLoading && ideas.length > 0" class="idea-grid">
    <div *ngFor="let idea of ideas" class="idea-card">
      <div class="idea-card-header">
        <div class="user-info">
          <span class="user-avatar">ðŸ‘¤</span>
          <div>
            <h3 class="user-name">{{ idea.nomeUsuario || 'AnÃ´nimo' }}</h3>
            <p class="user-email">{{ idea.emailUsuario }}</p>
            <p class="user-sector">{{ idea.setor }}</p>
          </div>
        </div>
        <div class="idea-status" [ngClass]="'status-' + (idea.status || 'PENDENTE')">
          {{ (idea.status || 'PENDENTE').replace('_', ' ') }}
        </div>
      </div>

      <div class="idea-card-body">

        <div class="info-group">
          <strong>DescriÃ§Ã£o do Problema:</strong>
          <p>{{ idea.descricaoProblema }}</p>
        </div>

        <div class="info-group" *ngIf="idea.possiveisSolucoes">
          <strong>PossÃ­veis SoluÃ§Ãµes:</strong>
          <p>{{ idea.possiveisSolucoes }}</p>
        </div>

        <div class="info-group">
        <strong>Impactos:</strong>
        
        <div class="impacts-container"> 
          <span *ngFor="let impact of idea.impactos" class="impact-item">
            {{ impact }}
          </span>
        </div>
        
      </div>

        <div class="info-grid">
          <div class="info-group" *ngIf="idea.interferencia !== undefined">
            <strong>InterferÃªncia:</strong>
            <p>{{ idea.interferencia }} / 10</p>
          </div>
          <div class="info-group" *ngIf="idea.expectativaMelhoria !== undefined">
            <strong>Expectativa:</strong>
            <p>{{ idea.expectativaMelhoria }} / 10</p>
          </div>
        </div>

        <div class="info-group" *ngIf="idea.nomeKaizen">
          <strong>SugestÃ£o de Nome para o Kaizen:</strong>
          <p>{{ idea.nomeKaizen }}</p>
        </div>

        <div class="info-group" *ngIf="idea.kaizenName">
          <strong>Nome do Kaizen:</strong>
          <p class="kaizen-name-official">{{ idea.kaizenName }}</p>
        </div>
        
      </div> <div class="idea-card-footer" *ngIf="idea.imageUrl">
        <strong>Anexo:</strong>
        <div *ngIf="idea.imageError" class="error-message-small">{{ idea.imageError }}</div>
        <div *ngIf="!idea.imageBlobUrl && !idea.imageError" class="spinner-small">Carregando imagem...</div>
        
        <img *ngIf="idea.imageBlobUrl" [src]="idea.imageBlobUrl" alt="Imagem da Ideia" class="idea-image" />
        
        <div class="image-actions" *ngIf="idea.imageBlobUrl">
          <a [href]="idea.imageBlobUrl" (click)="downloadImage($event, idea)" class="button button-small">Baixar</a>
          <a [href]="idea.imageBlobUrl" target="_blank" rel="noopener noreferrer" class="button button-small button-secondary">Visualizar</a>
        </div>
      </div>
      
    </div> 
  </div> 
</div>
