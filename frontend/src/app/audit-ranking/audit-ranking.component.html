<h2>游끥 Ranking das Auditorias 5S</h2>

<div class="controls-container">
  <div class="button-group">
    <button [class.active]="tipoRanking === 'total'" (click)="onTipoRankingChange('total')">
      Ver Ranking Total
    </button>
    <button [class.active]="tipoRanking === 'latest'" (click)="onTipoRankingChange('latest')">
      Ver 칔ltima Auditoria
    </button>
  </div>
  <button 
    *ngIf="authService.hasAnyRole(['ADMIN', 'MELHORIA_CONTINUA', 'COMITE_5S']) && ranking.length > 0"
    (click)="exportToExcel()" 
    class="export-button">
    游닌 Exportar para Excel
  </button>
</div>

<div *ngIf="loading" class="spinner">Carregando...</div>

<div *ngIf="!loading && ranking.length === 0" class="empty-message">
  Nenhum ranking dispon칤vel.
</div>

<div class="content-layout" *ngIf="!loading && ranking.length > 0">
  <div class="chart-container">
    <h3>Visualiza칞칚o Gr치fica</h3>
    <canvas #rankingChart></canvas>
  </div>

  <div class="ranking-container">
    <h3>Ranking Detalhado</h3>
    <ul class="ranking-list">
      <li *ngFor="let area of ranking; index as i" 
          (click)="selectArea(area.nomeArea)" 
          [class.selectable]="tipoRanking === 'total'">
        <span class="position">{{ i + 1 }}췈</span>
        <span class="area">{{ area.nomeArea }}</span>
        <span class="score">{{ area.pontuacao | number:'1.1-2' }} pontos</span>
      </li>
    </ul>

    <div *ngIf="selectedArea" class="history-details">
      <h4>Hist칩rico para: {{ selectedArea }}</h4>
      <div *ngIf="loadingHistory" class="spinner">Carregando hist칩rico...</div>
      
      <ul *ngIf="!loadingHistory" class="history-list">
        <li *ngFor="let audit of areaHistory" (click)="viewAuditDetails(audit)">
          Auditoria de {{ audit.auditDateTime | date:'dd/MM/yyyy' }}
          <span>{{ audit.notaFinal | number:'1.1-2' }} pontos &rarr;</span>
        </li>
      </ul>
      
      <div *ngIf="!loadingHistory && areaHistory.length === 0" class="empty-message">
        Nenhuma auditoria encontrada para esta 치rea.
      </div>
    </div>
  </div>
</div>

<div *ngIf="selectedAudit" class="modal-overlay" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <button class="close-button" (click)="closeModal()">칑</button>
    <h3>Detalhes da Auditoria - {{ selectedAudit?.nomeArea }}</h3>
    <p><strong>Data:</strong> {{ selectedAudit?.auditDateTime | date:'dd/MM/yyyy HH:mm' }}</p>
    <p><strong>Auditor:</strong> {{ selectedAudit?.auditor }}</p>
    
    <ul class="score-details">
      <li><strong>Seiri (Utiliza칞칚o):</strong> {{ selectedAudit?.seiri }}</li>
      <li><strong>Seiton (Organiza칞칚o):</strong> {{ selectedAudit?.seiton }}</li>
      <li><strong>Seis콄 (Limpeza):</strong> {{ selectedAudit?.seiso }}</li>
      <li><strong>Seiketsu (Padroniza칞칚o):</strong> {{ selectedAudit?.seiketsu }}</li>
      <li><strong>Shitsuke (Disciplina):</strong> {{ selectedAudit?.shitsuke }}</li>
      <li class="total-score"><strong>Nota Final:</strong> {{ selectedAudit?.notaFinal }}</li>
    </ul>

    <div *ngIf="selectedAudit?.imageUrl" class="image-section">
        <h4>Evid칡ncia Fotogr치fica</h4>
        <img [src]="'http://localhost:8080' + selectedAudit.imageUrl" alt="Imagem da auditoria">
        <a [href]="'http://localhost:8080' + selectedAudit.imageUrl" target="_blank" download class="button">Baixar Imagem</a>
    </div>
  </div>
</div>
